<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë£¨ì‹œë”” - ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        background-color: #0f172a; /* slate-900 */
        color: white;
        font-family: "Pretendard Variable", Pretendard, -apple-system,
          BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI",
          "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic",
          "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      }
      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body class="min-h-screen">
    <!-- Login Screen -->
    <div
      id="login-screen"
      class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900"
    >
      <div
        class="bg-slate-800 p-8 rounded-2xl shadow-xl max-w-sm w-full border border-slate-700 m-4"
      >
        <div class="flex justify-center mb-6">
          <div class="bg-red-500/10 p-4 rounded-full">
            <i data-lucide="shield-check" class="w-10 h-10 text-red-500"></i>
          </div>
        </div>
        <h2 class="text-xl font-bold mb-6 text-center text-white">
          ë£¨ì‹œë”” ê´€ë¦¬ì ë¡œê·¸ì¸
        </h2>
        <button
          id="google-login-btn"
          class="w-full bg-white text-black py-3.5 rounded-xl font-bold flex items-center justify-center gap-3 hover:bg-gray-200 transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 48 48"
            width="20px"
            height="20px"
          >
            <path
              fill="#FFC107"
              d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"
            />
            <path
              fill="#FF3D00"
              d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"
            />
            <path
              fill="#4CAF50"
              d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z"
            />
            <path
              fill="#1976D2"
              d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z"
            />
          </svg>
          Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
        </button>
        <p class="text-xs text-slate-400 mt-4 text-center">
          ë“±ë¡ëœ ë§ˆìŠ¤í„° ê³„ì •ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </p>
      </div>
    </div>

    <!-- Dashboard Main -->
    <div id="dashboard-screen" class="hidden flex h-screen overflow-hidden">
      <!-- Sidebar -->
      <aside class="w-64 bg-slate-800 border-r border-slate-700 flex flex-col">
        <div class="p-6 border-b border-slate-700">
          <h1 class="text-xl font-bold text-red-400 flex items-center gap-2">
            <i data-lucide="shield-check" class="w-6 h-6"></i> ë£¨ì‹œë”” ê´€ë¦¬ì
          </h1>
        </div>
        <nav class="flex-1 p-4 space-y-2">
          <button
            data-target="section-config"
            class="nav-tab w-full flex items-center gap-3 px-4 py-3 bg-red-500/10 text-red-400 font-bold rounded-lg text-left transition-colors"
          >
            <i data-lucide="smartphone" class="w-5 h-5"></i> ì•± ì—…ë°ì´íŠ¸ ê´€ë¦¬
          </button>
          <button
            data-target="section-reports"
            class="nav-tab w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-700/50 text-slate-300 rounded-lg text-left transition-colors"
          >
            <i data-lucide="flag" class="w-5 h-5"></i> ì‹ ê³  ë‚´ì—­ ê´€ë¦¬
          </button>
          <button
            data-target="section-blacklist"
            class="nav-tab w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-700/50 text-slate-300 rounded-lg text-left transition-colors"
          >
            <i data-lucide="users" class="w-5 h-5"></i> ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
          </button>
        </nav>
        <div class="p-4 border-t border-slate-700">
          <button
            id="logout-btn"
            class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-slate-700/50 hover:bg-slate-700 rounded-lg text-sm text-white font-bold transition-colors"
          >
            <i data-lucide="log-out" class="w-4 h-4"></i> ë¡œê·¸ì•„ì›ƒ
          </button>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="flex-1 overflow-y-auto p-8 bg-slate-900">
        <!-- ì•± ì—…ë°ì´íŠ¸ ê´€ë¦¬ ì„¹ì…˜ -->
        <section id="section-config" class="content-section max-w-2xl mx-auto">
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
            <i data-lucide="smartphone" class="w-7 h-7 text-red-400"></i>
            ì•± ê°•ì œ ì—…ë°ì´íŠ¸ ê´€ë¦¬
          </h2>

          <div
            class="bg-slate-800 rounded-2xl border border-slate-700 p-6 shadow-xl"
          >
            <div
              class="flex items-center justify-between bg-black/30 p-4 rounded-xl border border-white/5 mb-6"
            >
              <div class="flex items-center gap-3">
                <i data-lucide="info" class="w-5 h-5 text-slate-400"></i>
                <span class="text-sm text-slate-300 font-bold"
                  >í˜„ì¬ ê°•ì œ íŒì—… ë™ì‘ ìƒíƒœ</span
                >
              </div>
              <span
                id="config-status-text"
                class="text-[12px] font-bold px-3 py-1.5 rounded bg-gray-500/20 text-gray-400"
                >ì„¤ì • ì•ˆ ë¨</span
              >
            </div>

            <div class="space-y-6">
              <div>
                <label class="block text-sm text-slate-400 mb-2 font-bold"
                  >ìµœì†Œ ìš”êµ¬ ë²„ì „ (ì˜ˆ: 1.0.5)</label
                >
                <input
                  type="text"
                  id="config-version"
                  class="w-full bg-black/40 border border-slate-600 rounded-xl px-4 py-3.5 text-sm text-white outline-none focus:border-red-500 transition-colors"
                  placeholder="1.0.0"
                />
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-2 font-bold"
                  >ì—…ë°ì´íŠ¸ íŒì—… ë©”ì‹œì§€ (ì¤„ë°”ê¿ˆ ì‹œ \n ì‚¬ìš©)</label
                >
                <textarea
                  id="config-msg"
                  class="w-full bg-black/40 border border-slate-600 rounded-xl px-4 py-3.5 text-sm text-white outline-none focus:border-red-500 transition-colors h-28 resize-none leading-relaxed"
                ></textarea>
              </div>
              <div>
                <label class="block text-sm text-slate-400 mb-2 font-bold"
                  >ìŠ¤í† ì–´ ë§í¬ URL</label
                >
                <input
                  type="text"
                  id="config-url"
                  class="w-full bg-black/40 border border-slate-600 rounded-xl px-4 py-3.5 text-sm text-white outline-none focus:border-red-500 transition-colors"
                  placeholder="market://details?id=..."
                />
              </div>

              <div class="flex gap-3 pt-4">
                <button
                  id="admin-clear-btn"
                  class="flex-1 bg-slate-700 text-white rounded-xl py-4 font-bold hover:bg-slate-600 transition-colors hidden"
                >
                  ì´ˆê¸°í™” (ê°•ì œ ì¢…ë£Œ)
                </button>
                <button
                  id="admin-save-btn"
                  class="flex-1 bg-red-500 text-white rounded-xl py-4 font-bold hover:bg-red-600 transition-colors shadow-lg shadow-red-500/20"
                >
                  ìƒˆ ë²„ì „ìœ¼ë¡œ ì„¤ì • ì €ì¥
                </button>
              </div>
            </div>
          </div>
        </section>

        <!-- ì‹ ê³  ë‚´ì—­ ê´€ë¦¬ ì„¹ì…˜ -->
        <section
          id="section-reports"
          class="content-section hidden max-w-5xl mx-auto"
        >
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
            <i data-lucide="flag" class="w-7 h-7 text-red-400"></i>
            ì‹ ê³  ë‚´ì—­ ê´€ë¦¬
          </h2>
          <div
            class="bg-slate-800 p-8 rounded-2xl border border-slate-700 text-center"
          >
            <i
              data-lucide="loader"
              class="w-8 h-8 text-slate-500 animate-spin mx-auto mb-4"
            ></i>
            <p class="text-slate-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>
        </section>

        <!-- ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ ì„¹ì…˜ -->
        <section
          id="section-blacklist"
          class="content-section hidden max-w-5xl mx-auto"
        >
          <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
            <i data-lucide="users" class="w-7 h-7 text-red-400"></i>
            ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬
          </h2>
          <div
            class="bg-slate-800 p-8 rounded-2xl border border-slate-700 text-center"
          >
            <i
              data-lucide="loader"
              class="w-8 h-8 text-slate-500 animate-spin mx-auto mb-4"
            ></i>
            <p class="text-slate-400">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
          </div>
        </section>
      </main>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider,
        onAuthStateChanged,
        signOut,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
      import {
        getFirestore,
        doc,
        getDoc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyAsIc3kTstDICaxn1JwFOHIseP0NFUxyfk",
        authDomain: "onepicksoft-dream.firebaseapp.com",
        projectId: "onepicksoft-dream",
        storageBucket: "onepicksoft-dream.firebasestorage.app",
        messagingSenderId: "113950046877",
        appId: "1:113950046877:web:c06b5854e8c1210d007274",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);
      const MASTER_EMAIL = "onepicksoft@gmail.com";

      // 1. Screens
      const loginScreen = document.getElementById("login-screen");
      const dashboardScreen = document.getElementById("dashboard-screen");

      // 2. Auth Logic
      let isMasterCheckDone = false;
      const googleLoginBtn = document.getElementById("google-login-btn");
      const logoutBtn = document.getElementById("logout-btn");

      onAuthStateChanged(auth, async (user) => {
        if (user) {
          if (user.email === MASTER_EMAIL) {
            // ë§ˆìŠ¤í„° ë¡œê·¸ì¸ ì„±ê³µ ì‹œ ëŒ€ì‹œë³´ë“œ í‘œì‹œ
            loginScreen.classList.add("hidden");
            dashboardScreen.classList.remove("hidden");
            loadConfig();
            isMasterCheckDone = true;
          } else {
            // ë§ˆìŠ¤í„°ê°€ ì•„ë‹Œ ê²½ìš° íŠ•ê¹€
            if (isMasterCheckDone) return; // ì¤‘ë³µ ì•ŒëŸ¿ ë°©ì§€
            isMasterCheckDone = true;
            loginScreen.classList.remove("hidden");
            dashboardScreen.classList.add("hidden");
            alert("ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë§ˆìŠ¤í„° ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
            await signOut(auth);
          }
        } else {
          isMasterCheckDone = false; // ë¡œê·¸ì•„ì›ƒìƒíƒœ
          loginScreen.classList.remove("hidden");
          dashboardScreen.classList.add("hidden");
        }
      });

      googleLoginBtn.addEventListener("click", async () => {
        try {
          const provider = new GoogleAuthProvider();
          await signInWithPopup(auth, provider);
        } catch (e) {
          if (e.code !== "auth/popup-closed-by-user") {
            alert("ë¡œê·¸ì¸ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            console.error(e);
          }
        }
      });

      logoutBtn.addEventListener("click", async () => {
        await signOut(auth);
      });

      // 3. Tab Switching Logic
      const tabs = document.querySelectorAll(".nav-tab");
      const sections = document.querySelectorAll(".content-section");

      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          // ëª¨ë“  íƒ­ í•´ì œ
          tabs.forEach((t) => {
            t.className =
              "nav-tab w-full flex items-center gap-3 px-4 py-3 hover:bg-slate-700/50 text-slate-300 rounded-lg text-left transition-colors";
          });
          // í´ë¦­ íƒ­ í™œì„±í™”
          tab.className =
            "nav-tab w-full flex items-center gap-3 px-4 py-3 bg-red-500/10 text-red-400 font-bold rounded-lg text-left transition-colors";

          // í•´ë‹¹ ì„¹ì…˜ í™œì„±í™”
          const targetId = tab.getAttribute("data-target");
          sections.forEach((sec) => {
            if (sec.id === targetId) {
              sec.classList.remove("hidden");
            } else {
              sec.classList.add("hidden");
            }
          });
        });
      });

      // 4. App Update Config Logic
      const vInput = document.getElementById("config-version");
      const mInput = document.getElementById("config-msg");
      const uInput = document.getElementById("config-url");
      const saveBtn = document.getElementById("admin-save-btn");
      const clearBtn = document.getElementById("admin-clear-btn");
      const statusText = document.getElementById("config-status-text");

      function updateStatusUI(isActive) {
        if (isActive) {
          statusText.innerHTML = "ğŸŸ¢ íŒì—… ë™ì‘ ì¤‘";
          statusText.className =
            "text-[12px] font-bold px-3 py-1.5 rounded bg-green-500/20 text-green-400";
          saveBtn.classList.add("hidden");
          clearBtn.classList.remove("hidden");
        } else {
          statusText.innerHTML = "âš« ì„¤ì • í•´ì œë¨";
          statusText.className =
            "text-[12px] font-bold px-3 py-1.5 rounded bg-gray-500/20 text-gray-400";
          saveBtn.classList.remove("hidden");
          clearBtn.classList.add("hidden");
        }
      }

      async function loadConfig() {
        try {
          saveBtn.textContent = "ë¡œë”© ì¤‘...";
          const snap = await getDoc(doc(db, "settings", "app_config"));
          if (snap.exists()) {
            const data = snap.data();
            vInput.value = data.minVersion || "";
            mInput.value = data.updateMessage || "";
            uInput.value = data.storeUrl || "";
            updateStatusUI(!!data.minVersion);
          } else {
            updateStatusUI(false);
          }
        } catch (e) {
          console.error("Config Load Failed", e);
        } finally {
          saveBtn.textContent = "ìƒˆ ë²„ì „ìœ¼ë¡œ ì„¤ì • ì €ì¥";
        }
      }

      saveBtn.addEventListener("click", async () => {
        try {
          saveBtn.textContent = "ì €ì¥ ì¤‘...";
          await setDoc(
            doc(db, "settings", "app_config"),
            {
              minVersion: vInput.value,
              updateMessage: mInput.value,
              storeUrl: uInput.value,
            },
            { merge: true },
          );
          alert(
            "ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ê¸°ê¸°ì˜ ë²„ì „ì´ ì´ë³´ë‹¤ ë‚®ìœ¼ë©´ íŒì—…ì´ ì°¨ë‹¨í•©ë‹ˆë‹¤.",
          );
          updateStatusUI(true);
        } catch (e) {
          console.error(e);
          alert("ì €ì¥ ì‹¤íŒ¨");
        } finally {
          saveBtn.textContent = "ìƒˆ ë²„ì „ìœ¼ë¡œ ì„¤ì • ì €ì¥";
        }
      });

      clearBtn.addEventListener("click", async () => {
        try {
          clearBtn.textContent = "ì²˜ë¦¬ ì¤‘...";
          await setDoc(
            doc(db, "settings", "app_config"),
            {
              minVersion: "",
              updateMessage:
                "ìƒˆë¡œìš´ ë²„ì „ì´ í•„ìš”í•©ë‹ˆë‹¤.\nìŠ¤í† ì–´ì—ì„œ ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”.",
              storeUrl: "market://details?id=com.onepicksoft.dream",
            },
            { merge: true },
          );
          alert("ê°•ì œ ì—…ë°ì´íŠ¸ íŒì—…ì´ í•´ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
          vInput.value = "";
          mInput.value =
            "ìƒˆë¡œìš´ ë²„ì „ì´ í•„ìš”í•©ë‹ˆë‹¤.\nìŠ¤í† ì–´ì—ì„œ ì—…ë°ì´íŠ¸í•´ì£¼ì„¸ìš”.";
          uInput.value = "market://details?id=com.onepicksoft.dream";
          updateStatusUI(false);
        } catch (e) {
          console.error(e);
          alert("í•´ì œ ì‹¤íŒ¨");
        } finally {
          clearBtn.textContent = "ì´ˆê¸°í™” (ê°•ì œ ì¢…ë£Œ)";
        }
      });

      // Init Icons
      lucide.createIcons();
    </script>
  </body>
</html>
